<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Reports | FG Operations</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Add Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <!-- Add Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<style>
    /* Enhanced dropdown styling */
.stats-filter-select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 16px;
    padding-right: 36px;
}

/* Modern scrollbar for dropdown */
.stats-filter-select option {
    padding: 12px;
    margin: 2px 0;
}

.stats-filter-select option:hover {
    background: #f8f9fa;
}

.stats-filter-select option:checked {
    background: #2a5934;
    color: white;
}

/* Active state for refresh button */
.refresh-stats-btn.active {
    background: #2a5934;
    border-color: #2a5934;
    color: white;
}

.refresh-stats-btn.active:hover {
    background: #1e4227;
    border-color: #1e4227;
}

/* Loading spinner for refresh button */
.refresh-stats-btn.loading {
    position: relative;
    color: transparent;
}

.refresh-stats-btn.loading::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Badge for filter count */
.stats-filter-group {
    position: relative;
}

.filter-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #dc3545;
    color: white;
    font-size: 11px;
    font-weight: bold;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
}

/* Gradient border effect */
.statistics-section {
    position: relative;
}

.statistics-section::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #2a5934, #3a7d5a, #4aa180, #5abfa6);
    border-radius: 14px;
    z-index: -1;
    opacity: 0.1;
}

/* Auth Section Styles - EXTREMELY MINIMAL */
.auth-section {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
}

.auth-container {
    background: white;
    width: 100%;
    max-width: 300px;
    border: 1px solid #eaeef2;
}

.auth-header {
    padding: 24px 20px 8px 20px;
    text-align: center;
}

.auth-header h1 {
    margin: 0;
    font-size: 14px;
    font-weight: 500;
    color: #2a5934;
    letter-spacing: 0.5px;
}

/* Login Form - ULTRA MINIMAL */
#loginForm {
    padding: 16px 20px 20px 20px;
}

.form-group {
    margin-bottom: 14px;
}

.form-group label {
    display: block;
    margin-bottom: 2px;
    font-weight: 400;
    color: #7c8b9a;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.form-group input {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #eef2f6;
    border-radius: 2px;
    font-size: 12px;
    transition: all 0.15s;
    background: #ffffff;
}

.form-group input:focus {
    outline: none;
    border-color: #2a5934;
}

.password-field {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #b8c4ce;
    font-size: 11px;
    padding: 0;
}

.password-toggle:hover {
    color: #2a5934;
}

.form-actions {
    display: flex;
    gap: 8px;
    margin-top: 18px;
}

.auth-btn {
    flex: 1;
    padding: 8px 10px;
    border: none;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.3px;
}

.auth-btn.primary {
    background: #2a5934;
    color: white;
}

.auth-btn.primary:hover {
    background: #1e4227;
}

.auth-btn.secondary {
    background: #f8fafc;
    color: #5f6b7a;
    border: 1px solid #eef2f6;
}

.auth-btn.secondary:hover {
    background: #eef2f6;
}

.auth-footer {
    padding: 14px 20px;
    text-align: center;
    border-top: 1px solid #f0f4f8;
    background: #fafcfd;
}

.auth-footer p {
    margin: 0;
    color: #8f9eb0;
    font-size: 10px;
}

/* Admin create account button - MINIMAL */
.admin-create-account-btn {
    background: transparent;
    color: #2a5934;
    border: 1px solid #dde5ed;
    padding: 6px 14px;
    border-radius: 2px;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    margin-right: 10px;
    letter-spacing: 0.2px;
}

.admin-create-account-btn:hover {
    background: #f0f7f2;
    border-color: #2a5934;
}

/* Create Account Modal - MINIMAL PROFESSIONAL */
#createAccountModal .modal-content {
    max-width: 340px;
    border-radius: 0;
    box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    border: 1px solid #eef2f6;
}

#createAccountModal .modal-header {
    padding: 16px 20px;
    border-bottom: 1px solid #f0f4f8;
    background: #fafcfd;
}

#createAccountModal .modal-header h3 {
    font-size: 13px;
    font-weight: 500;
    color: #2a3b4c;
    margin: 0;
    letter-spacing: 0.2px;
}

#createAccountModal .modal-header h3 i {
    color: #2a5934;
    font-size: 12px;
    margin-right: 6px;
}

#createAccountModal .modal-body {
    padding: 20px;
}

.create-account-form .form-group {
    margin-bottom: 16px;
}

.create-account-form .form-group label {
    font-size: 10px;
    color: #7c8b9a;
    margin-bottom: 3px;
    text-transform: uppercase;
}

.create-account-form .form-group input {
    padding: 8px 10px;
    font-size: 12px;
    border: 1px solid #eef2f6;
    border-radius: 2px;
}

.role-selector {
    margin: 16px 0 8px;
    padding: 12px;
    background: #fafcfd;
    border: 1px solid #eef2f6;
}

.role-option {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.role-option:last-child {
    margin-bottom: 0;
}

.role-option input[type="radio"] {
    width: auto;
    margin-right: 8px;
    accent-color: #2a5934;
}

.role-option label {
    font-size: 11px;
    font-weight: 400;
    color: #2a3b4c;
}

.role-description {
    font-size: 10px;
    color: #8f9eb0;
    margin-left: 22px;
    margin-top: 2px;
}

#createAccountModal .modal-actions {
    padding: 16px 20px;
    border-top: 1px solid #f0f4f8;
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

#createAccountModal .btn {
    padding: 6px 14px;
    font-size: 11px;
    border-radius: 2px;
    font-weight: 500;
}

#createAccountModal .btn-primary {
    background: #2a5934;
    color: white;
    border: none;
}

#createAccountModal .btn-primary:hover {
    background: #1e4227;
}

#createAccountModal .btn-secondary {
    background: transparent;
    color: #5f6b7a;
    border: 1px solid #dde5ed;
}

#createAccountModal .btn-secondary:hover {
    background: #f8fafc;
}

/* User info - minimal */
.user-info {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-right: 12px;
    padding: 4px 10px;
    background: #f8fafc;
    border: 1px solid #eef2f6;
    font-size: 11px;
}

.user-role-badge {
    background: #2a5934;
    color: white;
    padding: 2px 6px;
    font-size: 9px;
    font-weight: 500;
    letter-spacing: 0.2px;
}

.logout-btn {
    background: none;
    border: 1px solid #dde5ed;
    color: #7c8b9a;
    padding: 4px 10px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.15s;
    border-radius: 2px;
}

.logout-btn:hover {
    border-color: #dc3545;
    color: #dc3545;
    background: #fff5f5;
}

/* Admin-only elements */
.admin-only {
    display: none;
}

body.admin .admin-only {
    display: inline-flex;
}

body.user .admin-only {
    display: none;
}

/* Delete button styling based on role */
.delete-btn-small {
    background: #dc3545;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 4px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.delete-btn-small:hover {
    background: #bd2130;
}

body.user .delete-btn-small {
    display: none;
}

/* User-only elements */
.user-only {
    display: none;
}

body.user .user-only {
    display: flex;
}

.close-modal {
    color: #b8c4ce;
    font-size: 18px;
    cursor: pointer;
    transition: color 0.15s;
}

.close-modal:hover {
    color: #2a3b4c;
}

/* Import button styles */
.import-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.import-btn:hover {
    background: #218838;
}

.import-section {
    margin: 15px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #2a5934;
}

.import-section.hidden {
    display: none;
}

.kitchen-category-badge {
    background: #fff3cd;
    color: #856404;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 500;
}

/* Kitchen category colors */
.category-meat {
    background: #f8d7da !important;
    color: #721c24 !important;
}

.category-vegetables {
    background: #d4edda !important;
    color: #155724 !important;
}

.category-seafood {
    background: #d1ecf1 !important;
    color: #0c5460 !important;
}
</style>
<body class="">
    <!-- Enhanced Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="modern-loader">
            <div class="gradient-loader"></div>
            <div class="loader-text" id="loaderText">Loading...</div>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>
    
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <img src="logo.jpg" alt="FG Operations Logo" class="nav-logo" loading="lazy" width="28" height="28">
                <span>FG Operations</span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="submit_waste_report.html">Report Waste</a></li>
                <li><a href="waste_report_table.html" class="active">View Reports</a></li>
            </ul>
            <div class="nav-actions" id="navActions">
                <!-- User info and logout will be inserted here by JavaScript -->
            </div>
        </nav>

        <!-- Authentication Section - EXTREMELY MINIMAL LOGIN -->
        <section id="authSection" class="auth-section">
            <div class="auth-container">
                <div class="auth-header">
                    <h1>FG OPERATIONS</h1>
                </div>
                
                <!-- Login Form - Ultra Minimal -->
                <div id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">EMAIL</label>
                        <input type="email" id="loginEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">PASSWORD</label>
                        <div class="password-field">
                            <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="auth-btn primary" onclick="handleLogin()">LOGIN</button>
                        <button class="auth-btn secondary" onclick="window.location.href='index.html'">HOME</button>
                    </div>
                </div>
                
                <div class="auth-footer">
                    <p>Authorized personnel only</p>
                </div>
            </div>
        </section>

        <!-- Reports Table Section -->
        <section id="reportsSection" class="reports-section" style="display: none;">
            <div class="section-header">
                <div class="header-title">
                    <h1><i class="fas fa-list-alt"></i> Submitted Reports</h1>
                    <p>Waste & Disposal Reports Database</p>
                </div>
                <div class="header-actions">
                    <!-- Admin-only buttons -->
                    <button class="btn btn-secondary admin-only" id="manageItemsButton" style="margin-right: 10px;">
                        <i class="fas fa-boxes"></i> Manage Items
                    </button>
                    <button class="btn btn-danger admin-only" id="deleteAllButton" style="margin-right: 10px;">
                        <i class="fas fa-trash-alt"></i> Delete All Reports
                    </button>
                    
                    <!-- MINIMAL Admin Create Account Button -->
                    <button class="admin-create-account-btn admin-only" id="createAccountButton" style="margin-right: 10px;">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    
                    <!-- User-only indicator -->
                    <div class="user-info user-only">
                        <i class="fas fa-user"></i>
                        <span id="userNameDisplay"></span>
                        <span class="user-role-badge">User</span>
                    </div>
                    
                    <!-- Logout button for everyone -->
                    <button class="logout-btn" id="logoutButton">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="table-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search reports...">
                </div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="filterStore">Store:</label>
                        <select id="filterStore" class="filter-select">
                            <option value="">All Stores</option>
                            <option>FG Express IROSIN</option>
                            <option>FG Express LIGAO</option>
                            <option>FG Express POLANGUI</option>
                            <option>FG Express MASBATE</option>
                            <option>FG Express DARAGA</option>
                            <option>FG Express BAAO</option>
                            <option>FG Express PIODURAN</option>
                            <option>FG Express RIZAL</option>
                            <option>FG to go TABACO</option>
                            <option>FG to go LEGAZPI</option>
                            <option>FG LEGAZPI</option>
                            <option>FG NAGA</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterType">Type:</label>
                        <select id="filterType" class="filter-select">
                            <option value="">All Types</option>
                            <option value="expired">Expired Items</option>
                            <option value="waste">Waste Items</option>
                            <option value="noWaste">No Waste</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterDateFrom">Date From:</label>
                        <input type="date" id="filterDateFrom" class="filter-select">
                    </div>
                    <div class="filter-group">
                        <label for="filterDateTo">Date To:</label>
                        <input type="date" id="filterDateTo" class="filter-select">
                    </div>
                    <div class="filter-group">
                        <label for="filterStatus">Approval:</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="partial">Partially Approved</option>
                            <option value="complete">Fully Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-secondary" id="clearFilters">
                            <i class="fas fa-filter-circle-xmark"></i> Clear Filters
                        </button>
                        <div class="export-dropdown">
                            <button class="btn btn-primary export-toggle" id="exportButton">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                            <div class="export-options">
                                <button class="export-option" data-type="all">
                                    <i class="fas fa-database"></i> Export All Reports
                                </button>
                                <button class="export-option" data-type="current">
                                    <i class="fas fa-filter"></i> Export Filtered Reports
                                </button>
                                <button class="export-option" data-type="date">
                                    <i class="fas fa-calendar-day"></i> Export by Date
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Date Selector -->
            <div id="exportDateContainer" class="export-date-container" style="display: none;">
                <div class="filter-group">
                    <label for="exportDate">Select Date:</label>
                    <input type="date" id="exportDate" class="filter-select">
                    <button class="btn btn-primary" id="exportDateButton">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-secondary" id="cancelExportDate">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>

            <!-- Reports Table -->
            <div class="table-container">
                <table id="reportsTable">
                    <thead>
                        <tr>
                            <th>Report ID</th>
                            <th>Store</th>
                            <th>Personnel</th>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Email</th>
                            <th>Submitted</th>
                            <th>Items</th>
                            <th>At-Cost (‚Ç±)</th>
                            <th>Approval</th>
                            <th class="admin-only">Actions</th>
                            <th class="user-only">View</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Reports will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="table-info">
                <div class="info-text">
                    Showing <span id="showingCount">0</span> of <span id="totalFilteredCount">0</span> reports
                </div>
                <div class="page-navigation">
                    <button class="page-btn" id="prevPageBtn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-info" id="pageInfo">Page 1</div>
                    <button class="page-btn" id="nextPageBtn" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-section">
                <div class="chart-header">
                    <h2><i class="fas fa-chart-bar"></i> Store Performance</h2>
                    <div class="period-info" id="periodInfo">All Time</div>
                    <div class="chart-type-selector">
                        <button class="chart-type-btn active" data-type="bar">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="chart-type-btn" data-type="line">
                            <i class="fas fa-chart-line"></i>
                        </button>
                        <button class="chart-type-btn" data-type="pie">
                            <i class="fas fa-chart-pie"></i>
                        </button>
                    </div>
                </div>
                
                <div class="chart-controls">
                    <!-- Store selector - only shown for line chart -->
                    <div id="storeSelectorContainer" class="chart-control-group" style="display: none;">
                        <label for="chartStore">Store:</label>
                        <select id="chartStore" class="chart-select">
                            <option value="all">All Stores</option>
                            <option>FG Express IROSIN</option>
                            <option>FG Express LIGAO</option>
                            <option>FG Express POLANGUI</option>
                            <option>FG Express MASBATE</option>
                            <option>FG Express DARAGA</option>
                            <option>FG Express BAAO</option>
                            <option>FG Express PIODURAN</option>
                            <option>FG Express RIZAL</option>
                            <option>FG to go TABACO</option>
                            <option>FG to go LEGAZPI</option>
                            <option>FG LEGAZPI</option>
                            <option>FG NAGA</option>
                        </select>
                    </div>
                    
                    <div class="chart-control-group">
                        <label for="chartPeriod">Period:</label>
                        <select id="chartPeriod" class="chart-select">
                            <option value="last7days">Last 7 Days</option>
                            <option value="last30days">Last 30 Days</option>
                            <option value="thisWeek">This Week</option>
                            <option value="lastWeek">Last Week</option>
                            <option value="thisMonth">This Month</option>
                            <option value="lastMonth">Last Month</option>
                            <option value="thisQuarter">This Quarter</option>
                            <option value="thisYear">This Year</option>
                            <option value="all">All Time</option>
                            <option value="specificDateRange">Date Range</option>
                        </select>
                    </div>
                    
                    <!-- Date range picker - only shown for specificDateRange -->
                    <div id="dateRangePickerContainer" class="chart-control-group" style="display: none;">
                        <label for="chartDateFrom">From:</label>
                        <input type="date" id="chartDateFrom" class="chart-select" style="width: 130px;">
                        <label for="chartDateTo" style="margin-left: 10px;">To:</label>
                        <input type="date" id="chartDateTo" class="chart-select" style="width: 130px;">
                    </div>
                    
                    <div class="chart-control-group">
                        <label for="chartMetric">Metric:</label>
                        <select id="chartMetric" class="chart-select">
                            <option value="cost">Total At-Cost (Approved only)</option>
                            <option value="totalCost">Total At-Cost (All items)</option>
                            <option value="reports">Reports Count</option>
                            <option value="items">Approved Items Count</option>
                            <option value="totalItems">All Items Count</option>
                            <option value="average">Average Cost (Approved)</option>
                            <option value="averageTotal">Average Cost (All items)</option>
                        </select>
                    </div>
                    
                    <div class="chart-control-group">
                        <label for="chartSort">Sort:</label>
                        <select id="chartSort" class="chart-select">
                            <option value="desc">High to Low</option>
                            <option value="asc">Low to High</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-secondary" id="refreshChart">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="storeChart"></canvas>
                </div>
                
                <div class="chart-stats">
                    <div class="chart-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Highest At-Cost</h4>
                            <div class="value" id="topStoreName">-</div>
                            <div class="subtext" id="topStoreValue">‚Ç±0.00</div>
                        </div>
                    </div>
                    
                    <div class="chart-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Total Cost</h4>
                            <div class="value" id="totalCost">‚Ç±0.00</div>
                            <div class="subtext" id="reportCount">0 reports</div>
                        </div>
                    </div>
                    
                    <div class="chart-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Consistent Store</h4>
                            <div class="value" id="consistentStore">-</div>
                            <div class="subtext" id="consistencyRate">0% rate</div>
                        </div>
                    </div>
                    
                    <div class="chart-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h4>Attention Needed</h4>
                            <div class="value" id="attentionStore">-</div>
                            <div class="subtext" id="attentionReason">No issues</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-footer">
                    <div>
                        <span>Daily rate: <strong id="dailyRate">0%</strong></span>
                    </div>
                    <div>
                        <span id="lastUpdated">Updated: -</span>
                    </div>
                </div>
            </div>

            <!-- Updated Statistics Section with Filter -->
            <section id="statisticsSection" class="statistics-section">
                <div class="stats-header">
                    <h2><i class="fas fa-chart-line"></i> Report Statistics</h2>
                    <div class="stats-filter-container">
                        <div class="stats-filter-group">
                            <label for="statsPeriodFilter"><i class="fas fa-filter"></i> Filter Period:</label>
                            <select id="statsPeriodFilter" class="stats-filter-select">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="thisWeek">This Week</option>
                                <option value="thisMonth">This Month</option>
                                <option value="lastMonth">Last Month</option>
                                <option value="thisYear">This Year</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon total-reports">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalReports">0</h3>
                            <p>Total Reports</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon expired">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="expiredCount">0</h3>
                            <p>Expired Items</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon waste">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="wasteCount">0</h3>
                            <p>Waste Reports</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon nowaste">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="noWasteCount">0</h3>
                            <p>No Waste</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="pendingApprovalCount">0</h3>
                            <p>Pending Approval</p>
                        </div>
                    </div>
                </div>
                <div class="stats-footer">
                    <span id="statsPeriodInfo">Showing statistics for: All Time</span>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <div class="footer-content">
                    <div class="footer-brand">
                        <img src="logo.jpg" alt="FG Operations Logo" class="footer-logo" loading="lazy" width="20" height="20">
                        <span>FG Operations Waste/Disposal Reporting System</span>
                    </div>
                    <div class="footer-links">
                        <a href="index.html">Home</a>
                        <a href="submit_waste_report.html">Submit Report</a>
                        <a href="waste_report_table.html">View Reports</a>
                    </div>
                    <p class="copyright"><i class="fas fa-shield-alt"></i> Access is restricted to authorized personnel only.</p>
                </div>
            </footer>
        </section>
    </div>

    <!-- Report Details Modal with Image Gallery -->
    <div id="detailsModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh;">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> Report Details</h3>
                <span class="close-modal" id="closeDetailsModal">&times;</span>
            </div>
            <div class="modal-body" style="overflow-y: auto;">
                <div id="modalContent">
                    <!-- Report details will be loaded here -->
                </div>
                
                <!-- Image Gallery Section -->
                <div id="imageGallerySection" class="image-gallery-section" style="display: none; margin-top: 20px;">
                    <h4><i class="fas fa-images"></i> Report Documentation</h4>
                    <div class="gallery-container" id="galleryContainer">
                        <!-- Images will be loaded here -->
                    </div>
                    <div id="galleryInfo" class="gallery-info"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger admin-only" id="deleteReportButton" style="margin-right: auto;">
                    <i class="fas fa-trash-alt"></i> Delete This Report
                </button>
                <button class="btn btn-secondary" onclick="closeDetailsModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh;">
            <div class="modal-header">
                <h3><i class="fas fa-image"></i> Image Preview</h3>
                <span class="close-modal" id="closeImageModal">&times;</span>
            </div>
            <div class="modal-body" style="text-align: center; padding: 20px;">
                <div style="position: relative; display: inline-block;">
                    <img id="modalImage" src="" alt="Preview" 
                         style="max-width: 85vw; max-height: 70vh; object-fit: contain; border-radius: 8px;">
                    <div id="imageLoading" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <div class="loading-spinner" style="border-width: 3px; width: 40px; height: 40px;"></div>
                    </div>
                </div>
                <div id="imageInfo" style="margin-top: 15px; font-size: 12px; color: var(--color-gray);">
                    <!-- Image info will be displayed here -->
                </div>
            </div>
            <div class="modal-actions" style="justify-content: center;">
                <button class="btn btn-secondary" onclick="closeImageModal()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-primary" id="downloadImageBtn" onclick="downloadCurrentImage()" style="display: none;">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn btn-danger admin-only" id="deleteImageBtn" onclick="deleteCurrentImage()" style="display: none;">
                    <i class="fas fa-trash-alt"></i> Delete Image
                </button>
            </div>
        </div>
    </div>

    <!-- Rejection Reason Modal -->
    <div id="rejectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-times-circle"></i> Reject Item</h3>
                <span class="close-modal" id="closeRejectionModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rejectionReason">Reason for Rejection *</label>
                    <textarea id="rejectionReason" rows="4" placeholder="Please provide a reason for rejecting this item..." required></textarea>
                    <div class="char-count" id="rejectionCharCount">0/500 characters</div>
                </div>
                <div id="rejectionItemInfo" style="font-size: 12px; color: var(--color-gray); margin-top: 10px;"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelRejectionButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" id="confirmRejectionButton">
                    <i class="fas fa-check"></i> Confirm Rejection
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Rejection Modal -->
    <div id="bulkRejectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-times-circle"></i> Reject Multiple Items</h3>
                <span class="close-modal" id="closeBulkRejectionModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bulkRejectionReason">Reason for Rejection *</label>
                    <textarea id="bulkRejectionReason" rows="4" placeholder="Please provide a reason for rejecting these items..." required></textarea>
                    <div class="char-count" id="bulkRejectionCharCount">0/500 characters</div>
                </div>
                <div id="bulkRejectionItemsInfo" style="font-size: 12px; color: var(--color-gray); margin-top: 10px;">
                    <p>You are about to reject <span id="bulkItemsCount">0</span> items from report: <strong id="bulkReportId"></strong></p>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelBulkRejectionButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" id="confirmBulkRejectionButton">
                    <i class="fas fa-check"></i> Confirm Rejection
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3><i class="fas fa-trash-alt"></i> Delete Report</h3>
                <span class="close-modal" id="closeDeleteModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-message" style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle" style="color: #856404; margin-right: 10px;"></i>
                    <strong style="color: #856404;">Warning: This action cannot be undone!</strong>
                </div>
                <p>Are you sure you want to delete this report?</p>
                <div id="deleteReportInfo" style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 15px 0; font-size: 13px;">
                    <!-- Report info will be populated here -->
                </div>
                <p><strong>This will also delete all associated images from storage.</strong></p>
                <div class="form-group">
                    <label for="deleteConfirmation">
                        Type "DELETE" to confirm <span class="required">*</span>
                    </label>
                    <input type="text" id="deleteConfirmation" placeholder="Type DELETE here" style="text-transform: uppercase;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDeleteButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" id="confirmDeleteButton" disabled>
                    <i class="fas fa-trash-alt"></i> Delete Report
                </button>
            </div>
        </div>
    </div>

    <!-- Delete All Confirmation Modal -->
    <div id="deleteAllModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-trash-alt"></i> Delete All Reports</h3>
                <span class="close-modal" id="closeDeleteAllModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-message" style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle" style="color: #721c24; margin-right: 10px;"></i>
                    <strong style="color: #721c24;">Danger: This action cannot be undone!</strong>
                </div>
                <p>You are about to delete <strong id="deleteAllCount">0</strong> reports.</p>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 15px 0; font-size: 13px;">
                    <p><i class="fas fa-images"></i> All associated images will be deleted from storage</p>
                    <p><i class="fas fa-database"></i> This will free up storage space</p>
                    <p><i class="fas fa-history"></i> This action is permanent</p>
                </div>
                <div class="form-group">
                    <label for="deleteAllConfirmation">
                        Type "DELETE ALL" to confirm <span class="required">*</span>
                    </label>
                    <input type="text" id="deleteAllConfirmation" placeholder="Type DELETE ALL here" style="text-transform: uppercase;">
                </div>
                <div class="filter-group" style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" id="applyFiltersToDeleteAll">
                        Apply current filters
                    </label>
                    <small style="display: block; color: #666; margin-top: 5px;">If checked, only filtered reports will be deleted</small>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDeleteAllButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" id="confirmDeleteAllButton" disabled>
                    <i class="fas fa-trash-alt"></i> Delete All Reports
                </button>
            </div>
        </div>
    </div>

    <!-- Items Management Modal with Category Dropdown and Import -->
    <div id="itemsManagementModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 85vh;">
            <div class="modal-header">
                <h3><i class="fas fa-boxes"></i> Manage Items Database</h3>
                <span class="close-modal" id="closeItemsModal">&times;</span>
            </div>
            <div class="modal-body" style="overflow-y: auto;">
                <!-- Item Type Selector Dropdown -->
                <div class="item-type-selector" style="margin-bottom: 15px; padding: 15px; background: var(--color-offwhite); border-radius: var(--border-radius); border: var(--border-base);">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <i class="fas fa-layer-group" style="color: var(--color-primary);"></i>
                            <label for="itemTypeSelect" style="font-weight: 500; color: var(--color-darkgray);">Item Category:</label>
                            <select id="itemTypeSelect" class="filter-select" style="min-width: 180px; background: white;">
                                <option value="regular">üì¶ Store Items</option>
                                <option value="kitchen">üç≥ Kitchen Items</option>
                            </select>
                        </div>
                        <div class="item-type-badge" id="itemTypeBadge" style="background: var(--color-primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 500;">
                            <i class="fas fa-box"></i> Store Items
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px; color: var(--color-gray); display: flex; gap: 15px; flex-wrap: wrap;">
                        <span><i class="fas fa-info-circle"></i> Switch between store and kitchen item categories</span>
                        <span id="categoryItemCount">0 items</span>
                    </div>
                </div>

                <!-- Add Item Form -->
                <div class="add-item-section">
                    <h4><i class="fas fa-plus-circle"></i> Add New Item</h4>
                    <div class="form-grid">
                        <div class="form-group" style="flex: 1;">
                            <label for="newItemName">Item Name *</label>
                            <input type="text" id="newItemName" placeholder="Enter item name" maxlength="100">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="newItemCost">Unit Cost (‚Ç±) *</label>
                            <input type="number" id="newItemCost" step="0.01" min="0" placeholder="0.00" value="0">
                        </div>
                        <!-- Kitchen Category Dropdown - Only shown when kitchen items are selected -->
                        <div class="form-group" id="kitchenCategoryGroup" style="flex: 1; display: none;">
                            <label for="newItemKitchenCategory">Kitchen Category <span class="required">*</span></label>
                            <select id="newItemKitchenCategory" class="filter-select">
                                <option value="meat">ü•© Meat</option>
                                <option value="vegetables">ü•¨ Vegetables</option>
                                <option value="seafood">ü¶ê Seafood</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="addItemButton">
                        <i class="fas fa-plus"></i> Add Item to Database
                    </button>
                </div>

                <!-- Import Section -->
                <div class="import-section">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0;"><i class="fas fa-file-import"></i> Import Items from Excel</h4>
                            <p style="font-size: 11px; color: #666; margin: 0;">Upload XLSX file with columns: Item Name, Cost, Category (meat/vegetables/seafood for kitchen items)</p>
                        </div>
                        <input type="file" id="importFileInput" accept=".xlsx, .xls" style="display: none;">
                        <button class="import-btn" id="importItemsButton">
                            <i class="fas fa-upload"></i> Import XLSX
                        </button>
                    </div>
                    <div id="importPreview" style="margin-top: 15px; display: none;">
                        <!-- Import preview will be shown here -->
                    </div>
                </div>

                <!-- Search -->
                <div class="items-controls">
                    <div class="search-box" style="flex: 1;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchItems" placeholder="Search items...">
                    </div>
                </div>

                <!-- Items Table -->
                <div class="table-container" style="max-height: 250px; overflow-y: auto; margin: 15px 0;">
                    <table id="itemsTable">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Unit Cost (‚Ç±)</th>
                                <th>Category</th>
                                <th>Kitchen Category</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="itemsTableBody">
                            <!-- Items will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Items Pagination -->
                <div class="table-info">
                    <div class="info-text">
                        Showing <span id="showingItemsCount">0</span> items
                    </div>
                    <div class="page-navigation">
                        <button class="page-btn" id="prevItemsPageBtn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="page-info" id="itemsPageInfo">Page 1</div>
                        <button class="page-btn" id="nextItemsPageBtn" disabled>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-cards" style="margin-top: 15px;">
                    <div class="stat-card" style="flex: 1; min-width: 150px;">
                        <div class="stat-icon total-reports">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalRegularItemsCount">0</h3>
                            <p>Total Store Items</p>
                        </div>
                    </div>
                    <div class="stat-card" style="flex: 1; min-width: 150px;">
                        <div class="stat-icon" style="background: #fff3cd; color: #856404;">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalKitchenItemsCount">0</h3>
                            <p>Total Kitchen Items</p>
                        </div>
                    </div>
                </div>

                <!-- Kitchen Category Stats -->
                <div id="kitchenCategoryStats" style="margin-top: 10px; display: none;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <span class="kitchen-category-badge category-meat">ü•© Meat: <span id="meatCount">0</span></span>
                        <span class="kitchen-category-badge category-vegetables">ü•¨ Vegetables: <span id="vegetablesCount">0</span></span>
                        <span class="kitchen-category-badge category-seafood">ü¶ê Seafood: <span id="seafoodCount">0</span></span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeItemsModalButton">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Item Modal -->
    <div id="editItemModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Item</h3>
                <span class="close-modal" id="closeEditItemModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editItemName">Item Name *</label>
                    <input type="text" id="editItemName" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="editItemCost">Unit Cost (‚Ç±) *</label>
                    <input type="number" id="editItemCost" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="editItemCategory">Main Category</label>
                    <select id="editItemCategory" class="filter-select">
                        <option value="regular">üì¶ Store Items</option>
                        <option value="kitchen">üç≥ Kitchen Items</option>
                    </select>
                </div>
                <div class="form-group" id="editKitchenCategoryGroup">
                    <label for="editItemKitchenCategory">Kitchen Category</label>
                    <select id="editItemKitchenCategory" class="filter-select">
                        <option value="meat">ü•© Meat</option>
                        <option value="vegetables">ü•¨ Vegetables</option>
                        <option value="seafood">ü¶ê Seafood</option>
                    </select>
                </div>
                <div id="editItemInfo" style="font-size: 12px; color: var(--color-gray); margin-top: 10px;"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelEditItemButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" id="saveItemButton">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Image Delete Confirmation Modal -->
    <div id="deleteImageModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-trash-alt"></i> Delete Image</h3>
                <span class="close-modal" id="closeDeleteImageModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-message" style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <i class="fas fa-exclamation-triangle" style="color: #856404; margin-right: 10px;"></i>
                    <strong style="color: #856404;">This will delete the image from storage</strong>
                </div>
                <p>Are you sure you want to delete this image?</p>
                <div id="deleteImageInfo" style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 13px;">
                    <!-- Image info will be populated here -->
                </div>
                <p>This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDeleteImageButton">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" id="confirmDeleteImageButton">
                    <i class="fas fa-trash-alt"></i> Delete Image
                </button>
            </div>
        </div>
    </div>

    <!-- MINIMAL Create Account Modal -->
    <div id="createAccountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> New Account</h3>
                <span class="close-modal" id="closeCreateAccountModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="create-account-form">
                    <div class="form-group">
                        <label for="newAccountEmail">EMAIL</label>
                        <input type="email" id="newAccountEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label for="newAccountPassword">PASSWORD</label>
                        <div class="password-field">
                            <input type="password" id="newAccountPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle" onclick="togglePassword('newAccountPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newAccountConfirmPassword">CONFIRM</label>
                        <div class="password-field">
                            <input type="password" id="newAccountConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle" onclick="togglePassword('newAccountConfirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newAccountFullName">FULL NAME</label>
                        <input type="text" id="newAccountFullName" placeholder="John Smith">
                    </div>
                    
                    <div class="role-selector">
                        <div class="role-option">
                            <input type="radio" id="roleUser" name="accountRole" value="user" checked>
                            <label for="roleUser">User</label>
                            <div class="role-description">Submit and view reports</div>
                        </div>
                        <div class="role-option">
                            <input type="radio" id="roleAdmin" name="accountRole" value="admin">
                            <label for="roleAdmin">Admin</label>
                            <div class="role-description">Full access including user mgmt</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelCreateAccount">Cancel</button>
                <button class="btn btn-primary" id="createAccountSubmit">Create</button>
            </div>
        </div>
    </div>

        <!-- E-Signature Modal -->
    <div id="signatureModal" class="modal">
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h3><i class="fas fa-signature"></i> Admin E-Signature</h3>
                <span class="close-modal" id="closeSignatureModal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                        Upload or draw your e-signature. This will appear in approval/rejection emails instead of your email address.
                    </p>
                    
                    <!-- Signature Type Selection -->
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="radio" name="signatureType" id="signatureTypeUpload" value="upload" checked onchange="onSignatureTypeChange()">
                            <span>Upload Signature</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="radio" name="signatureType" id="signatureTypeDraw" value="draw" onchange="onSignatureTypeChange()">
                            <span>Draw Signature</span>
                        </label>
                    </div>
                    
                    <!-- Upload Signature Section -->
                    <div id="signatureUploadSection">
                        <div style="border: 2px dashed #2a5934; padding: 20px; text-align: center; margin-bottom: 15px;">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: #2a5934; margin-bottom: 10px;"></i>
                            <p style="margin-bottom: 10px;">Upload your signature image (PNG, JPG, max 2MB)</p>
                            <input type="file" id="signatureFile" accept="image/*" style="display: none;">
                            <button class="btn btn-secondary" onclick="document.getElementById('signatureFile').click()">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                            <button class="btn btn-primary" id="uploadSignatureBtn" onclick="uploadSignatureImage()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                        </div>
                    </div>
                    
                    <!-- Draw Signature Section -->
                    <div id="signatureDrawSection" style="display: none;">
                        <div style="border: 1px solid #ddd; padding: 10px; text-align: center;">
                            <canvas id="signatureCanvas" width="400" height="150" style="border: 1px solid #ccc; background: white; width: 100%; height: auto; cursor: crosshair;"></canvas>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" id="clearSignatureBtn" onclick="clearSignaturePad()">
                                    <i class="fas fa-eraser"></i> Clear
                                </button>
                                <button class="btn btn-primary" id="saveSignatureBtn" onclick="saveDrawnSignature()">
                                    <i class="fas fa-save"></i> Save Signature
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Current Signature Preview -->
                    <div id="signaturePreviewSection" style="margin-top: 20px;">
                        <h4 style="font-size: 12px; color: #666; margin-bottom: 10px;">Current Signature:</h4>
                        <div id="signaturePreview" style="background: #f9f9f9; padding: 10px; border: 1px solid #eee; min-height: 50px; text-align: center;">
                            <!-- Signature preview will appear here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelSignatureButton">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Update Firebase imports to include Storage and Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="waste_report_table.js"></script>
</body>
</html>